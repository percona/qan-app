/* tslint:disable:no-unused-variable */

import {TestBed, async, inject, fakeAsync, tick, ComponentFixture} from '@angular/core/testing';
import {BaseRequestOptions, ConnectionBackend, Http, HttpModule, RequestOptions} from '@angular/http';
import {NO_ERRORS_SCHEMA} from '@angular/core';
import {MockBackend} from '@angular/http/testing';
import {MongoQueryDetailsService} from './mongo-query-details.service';

describe('MongoQueryDetailsService', () => {
  let service: MongoQueryDetailsService;
  let backend: MockBackend;

  beforeEach(() => {
    TestBed.configureTestingModule({
      imports: [HttpModule],
      providers: [
        MockBackend,
        BaseRequestOptions,
        {
          provide: Http,
          useFactory: (backend, defaultOptions) => new Http(backend, defaultOptions),
          deps: [MockBackend, BaseRequestOptions]
        },
        MongoQueryDetailsService
      ],
      schemas: [NO_ERRORS_SCHEMA]
    });
    backend = TestBed.get(MockBackend);
    service = TestBed.get(MongoQueryDetailsService);
  });

  it('should be empty array if response data is undefined', () => {
    expect(service).toBeTruthy();
  });

  it('should be true if getQueryDetails response data is valid', fakeAsync(() => {
    const dataResponse = {
      '_body': '{"InstanceId":"45845e61c7ee444b7e6a17891118a66a","Begin":"2018-09-30T23:58:12Z","End":"2018-10-01T11:58:12Z","Query":{"Id":"b3a7070408ce8743f7ca1180f9cee82d","Abstract":"INSERT sbtest1","Fingerprint":"INSERT sbtest1","Tables":null,"FirstSeen":"2018-10-01T11:51:00Z","LastSeen":"2018-10-01T11:56:00Z","Status":"new"},"Metrics":null,"Example":{"QueryId":"","InstanceUUID":"","Period":"2018-10-01T00:00:00Z","Ts":"2018-10-01T11:55:00Z","Db":"sbtest","QueryTime":57750,"Query":"{\\"ns\\":\\"sbtest.sbtest1\\",\\"op\\":\\"insert\\"}\\n"},"Metrics2":{"Query_count":148,"Query_time_sum":270.87,"Query_time_min":0.297,"Query_time_avg":3.319498,"Query_time_med":2.837,"Query_time_p95":6.5765,"Query_time_max":15.601,"Lock_time_sum":0,"Lock_time_min":0,"Lock_time_avg":0,"Lock_time_med":0,"Lock_time_p95":0,"Lock_time_max":0,"Rows_sent_sum":0,"Rows_sent_min":0,"Rows_sent_avg":0,"Rows_sent_med":0,"Rows_sent_p95":0,"Rows_sent_max":0,"Rows_examined_sum":0,"Rows_examined_min":0,"Rows_examined_avg":0,"Rows_examined_med":0,"Rows_examined_p95":0,"Rows_examined_max":0,"Bytes_sent_sum":5920,"Bytes_sent_min":40,"Bytes_sent_avg":40,"Bytes_sent_med":40,"Bytes_sent_p95":40,"Bytes_sent_max":40,"Query_count_of_total":0.058870327,"Query_time_sum_of_total":0.06435997,"Lock_time_sum_of_total":0,"Rows_sent_sum_of_total":0,"Rows_examined_sum_of_total":0,"Bytes_sent_sum_of_total":0.058870327,"Point":0,"Ts":"0001-01-01T00:00:00Z","NoData":false,"Query_count_per_sec":0.003425926,"Query_time_sum_per_sec":0.0062701385,"Bytes_sent_sum_per_sec":0.13703704},"Sparks2":[{"Point":0,"Ts":"2018-10-01T11:58:12Z","NoData":false,"Query_count_per_sec":0.2056,"Query_time_sum_per_sec":0.37620834,"Bytes_sent_sum_per_sec":8.2222},{"Point":1,"Ts":"2018-10-01T11:46:12Z","NoData":true},{"Point":2,"Ts":"2018-10-01T11:34:12Z","NoData":true},{"Point":3,"Ts":"2018-10-01T11:22:12Z","NoData":true},{"Point":4,"Ts":"2018-10-01T11:10:12Z","NoData":true},{"Point":5,"Ts":"2018-10-01T10:58:12Z","NoData":true},{"Point":6,"Ts":"2018-10-01T10:46:12Z","NoData":true},{"Point":7,"Ts":"2018-10-01T10:34:12Z","NoData":true},{"Point":8,"Ts":"2018-10-01T10:22:12Z","NoData":true},{"Point":9,"Ts":"2018-10-01T10:10:12Z","NoData":true},{"Point":10,"Ts":"2018-10-01T09:58:12Z","NoData":true},{"Point":11,"Ts":"2018-10-01T09:46:12Z","NoData":true},{"Point":12,"Ts":"2018-10-01T09:34:12Z","NoData":true},{"Point":13,"Ts":"2018-10-01T09:22:12Z","NoData":true},{"Point":14,"Ts":"2018-10-01T09:10:12Z","NoData":true},{"Point":15,"Ts":"2018-10-01T08:58:12Z","NoData":true},{"Point":16,"Ts":"2018-10-01T08:46:12Z","NoData":true},{"Point":17,"Ts":"2018-10-01T08:34:12Z","NoData":true},{"Point":18,"Ts":"2018-10-01T08:22:12Z","NoData":true},{"Point":19,"Ts":"2018-10-01T08:10:12Z","NoData":true},{"Point":20,"Ts":"2018-10-01T07:58:12Z","NoData":true},{"Point":21,"Ts":"2018-10-01T07:46:12Z","NoData":true},{"Point":22,"Ts":"2018-10-01T07:34:12Z","NoData":true},{"Point":23,"Ts":"2018-10-01T07:22:12Z","NoData":true},{"Point":24,"Ts":"2018-10-01T07:10:12Z","NoData":true},{"Point":25,"Ts":"2018-10-01T06:58:12Z","NoData":true},{"Point":26,"Ts":"2018-10-01T06:46:12Z","NoData":true},{"Point":27,"Ts":"2018-10-01T06:34:12Z","NoData":true},{"Point":28,"Ts":"2018-10-01T06:22:12Z","NoData":true},{"Point":29,"Ts":"2018-10-01T06:10:12Z","NoData":true},{"Point":30,"Ts":"2018-10-01T05:58:12Z","NoData":true},{"Point":31,"Ts":"2018-10-01T05:46:12Z","NoData":true},{"Point":32,"Ts":"2018-10-01T05:34:12Z","NoData":true},{"Point":33,"Ts":"2018-10-01T05:22:12Z","NoData":true},{"Point":34,"Ts":"2018-10-01T05:10:12Z","NoData":true},{"Point":35,"Ts":"2018-10-01T04:58:12Z","NoData":true},{"Point":36,"Ts":"2018-10-01T04:46:12Z","NoData":true},{"Point":37,"Ts":"2018-10-01T04:34:12Z","NoData":true},{"Point":38,"Ts":"2018-10-01T04:22:12Z","NoData":true},{"Point":39,"Ts":"2018-10-01T04:10:12Z","NoData":true},{"Point":40,"Ts":"2018-10-01T03:58:12Z","NoData":true},{"Point":41,"Ts":"2018-10-01T03:46:12Z","NoData":true},{"Point":42,"Ts":"2018-10-01T03:34:12Z","NoData":true},{"Point":43,"Ts":"2018-10-01T03:22:12Z","NoData":true},{"Point":44,"Ts":"2018-10-01T03:10:12Z","NoData":true},{"Point":45,"Ts":"2018-10-01T02:58:12Z","NoData":true},{"Point":46,"Ts":"2018-10-01T02:46:12Z","NoData":true},{"Point":47,"Ts":"2018-10-01T02:34:12Z","NoData":true},{"Point":48,"Ts":"2018-10-01T02:22:12Z","NoData":true},{"Point":49,"Ts":"2018-10-01T02:10:12Z","NoData":true},{"Point":50,"Ts":"2018-10-01T01:58:12Z","NoData":true},{"Point":51,"Ts":"2018-10-01T01:46:12Z","NoData":true},{"Point":52,"Ts":"2018-10-01T01:34:12Z","NoData":true},{"Point":53,"Ts":"2018-10-01T01:22:12Z","NoData":true},{"Point":54,"Ts":"2018-10-01T01:10:12Z","NoData":true},{"Point":55,"Ts":"2018-10-01T00:58:12Z","NoData":true},{"Point":56,"Ts":"2018-10-01T00:46:12Z","NoData":true},{"Point":57,"Ts":"2018-10-01T00:34:12Z","NoData":true},{"Point":58,"Ts":"2018-10-01T00:22:12Z","NoData":true},{"Point":59,"Ts":"2018-10-01T00:10:12Z","NoData":true}]}',
      'status': 200,
      'ok': true,
      'statusText': 'OK',
      'type': 2,
      'url': 'http://localhost/qan-api/qan/report/45845e61c7ee444b7e6a17891118a66a/query/b3a7070408ce8743f7ca1180f9cee82d?begin=2018-09-30T23:58:12&end=2018-10-01T11:58:12',
      json: () => {
        return JSON.parse(dataResponse._body)
      }
    };

    backend.connections.subscribe(connection => {
      connection.mockRespond(dataResponse);
    });

    const result = service.getQueryDetails('agentUUID', 'serverUUID', '123456789', '987654321');
    tick();
    expect(result).toBeTruthy();
  }));

  it('should be true if getSummary response data is valid', fakeAsync(() => {
    const dataResponse = {
      '_body': '{"InstanceId":"45845e61c7ee444b7e6a17891118a66a","Begin":"2018-09-30T23:58:12Z","End":"2018-10-01T11:58:12Z","Query":{"Id":"b3a7070408ce8743f7ca1180f9cee82d","Abstract":"INSERT sbtest1","Fingerprint":"INSERT sbtest1","Tables":null,"FirstSeen":"2018-10-01T11:51:00Z","LastSeen":"2018-10-01T11:56:00Z","Status":"new"},"Metrics":null,"Example":{"QueryId":"","InstanceUUID":"","Period":"2018-10-01T00:00:00Z","Ts":"2018-10-01T11:55:00Z","Db":"sbtest","QueryTime":57750,"Query":"{\\"ns\\":\\"sbtest.sbtest1\\",\\"op\\":\\"insert\\"}\\n"},"Metrics2":{"Query_count":148,"Query_time_sum":270.87,"Query_time_min":0.297,"Query_time_avg":3.319498,"Query_time_med":2.837,"Query_time_p95":6.5765,"Query_time_max":15.601,"Lock_time_sum":0,"Lock_time_min":0,"Lock_time_avg":0,"Lock_time_med":0,"Lock_time_p95":0,"Lock_time_max":0,"Rows_sent_sum":0,"Rows_sent_min":0,"Rows_sent_avg":0,"Rows_sent_med":0,"Rows_sent_p95":0,"Rows_sent_max":0,"Rows_examined_sum":0,"Rows_examined_min":0,"Rows_examined_avg":0,"Rows_examined_med":0,"Rows_examined_p95":0,"Rows_examined_max":0,"Bytes_sent_sum":5920,"Bytes_sent_min":40,"Bytes_sent_avg":40,"Bytes_sent_med":40,"Bytes_sent_p95":40,"Bytes_sent_max":40,"Query_count_of_total":0.058870327,"Query_time_sum_of_total":0.06435997,"Lock_time_sum_of_total":0,"Rows_sent_sum_of_total":0,"Rows_examined_sum_of_total":0,"Bytes_sent_sum_of_total":0.058870327,"Point":0,"Ts":"0001-01-01T00:00:00Z","NoData":false,"Query_count_per_sec":0.003425926,"Query_time_sum_per_sec":0.0062701385,"Bytes_sent_sum_per_sec":0.13703704},"Sparks2":[{"Point":0,"Ts":"2018-10-01T11:58:12Z","NoData":false,"Query_count_per_sec":0.2056,"Query_time_sum_per_sec":0.37620834,"Bytes_sent_sum_per_sec":8.2222},{"Point":1,"Ts":"2018-10-01T11:46:12Z","NoData":true},{"Point":2,"Ts":"2018-10-01T11:34:12Z","NoData":true},{"Point":3,"Ts":"2018-10-01T11:22:12Z","NoData":true},{"Point":4,"Ts":"2018-10-01T11:10:12Z","NoData":true},{"Point":5,"Ts":"2018-10-01T10:58:12Z","NoData":true},{"Point":6,"Ts":"2018-10-01T10:46:12Z","NoData":true},{"Point":7,"Ts":"2018-10-01T10:34:12Z","NoData":true},{"Point":8,"Ts":"2018-10-01T10:22:12Z","NoData":true},{"Point":9,"Ts":"2018-10-01T10:10:12Z","NoData":true},{"Point":10,"Ts":"2018-10-01T09:58:12Z","NoData":true},{"Point":11,"Ts":"2018-10-01T09:46:12Z","NoData":true},{"Point":12,"Ts":"2018-10-01T09:34:12Z","NoData":true},{"Point":13,"Ts":"2018-10-01T09:22:12Z","NoData":true},{"Point":14,"Ts":"2018-10-01T09:10:12Z","NoData":true},{"Point":15,"Ts":"2018-10-01T08:58:12Z","NoData":true},{"Point":16,"Ts":"2018-10-01T08:46:12Z","NoData":true},{"Point":17,"Ts":"2018-10-01T08:34:12Z","NoData":true},{"Point":18,"Ts":"2018-10-01T08:22:12Z","NoData":true},{"Point":19,"Ts":"2018-10-01T08:10:12Z","NoData":true},{"Point":20,"Ts":"2018-10-01T07:58:12Z","NoData":true},{"Point":21,"Ts":"2018-10-01T07:46:12Z","NoData":true},{"Point":22,"Ts":"2018-10-01T07:34:12Z","NoData":true},{"Point":23,"Ts":"2018-10-01T07:22:12Z","NoData":true},{"Point":24,"Ts":"2018-10-01T07:10:12Z","NoData":true},{"Point":25,"Ts":"2018-10-01T06:58:12Z","NoData":true},{"Point":26,"Ts":"2018-10-01T06:46:12Z","NoData":true},{"Point":27,"Ts":"2018-10-01T06:34:12Z","NoData":true},{"Point":28,"Ts":"2018-10-01T06:22:12Z","NoData":true},{"Point":29,"Ts":"2018-10-01T06:10:12Z","NoData":true},{"Point":30,"Ts":"2018-10-01T05:58:12Z","NoData":true},{"Point":31,"Ts":"2018-10-01T05:46:12Z","NoData":true},{"Point":32,"Ts":"2018-10-01T05:34:12Z","NoData":true},{"Point":33,"Ts":"2018-10-01T05:22:12Z","NoData":true},{"Point":34,"Ts":"2018-10-01T05:10:12Z","NoData":true},{"Point":35,"Ts":"2018-10-01T04:58:12Z","NoData":true},{"Point":36,"Ts":"2018-10-01T04:46:12Z","NoData":true},{"Point":37,"Ts":"2018-10-01T04:34:12Z","NoData":true},{"Point":38,"Ts":"2018-10-01T04:22:12Z","NoData":true},{"Point":39,"Ts":"2018-10-01T04:10:12Z","NoData":true},{"Point":40,"Ts":"2018-10-01T03:58:12Z","NoData":true},{"Point":41,"Ts":"2018-10-01T03:46:12Z","NoData":true},{"Point":42,"Ts":"2018-10-01T03:34:12Z","NoData":true},{"Point":43,"Ts":"2018-10-01T03:22:12Z","NoData":true},{"Point":44,"Ts":"2018-10-01T03:10:12Z","NoData":true},{"Point":45,"Ts":"2018-10-01T02:58:12Z","NoData":true},{"Point":46,"Ts":"2018-10-01T02:46:12Z","NoData":true},{"Point":47,"Ts":"2018-10-01T02:34:12Z","NoData":true},{"Point":48,"Ts":"2018-10-01T02:22:12Z","NoData":true},{"Point":49,"Ts":"2018-10-01T02:10:12Z","NoData":true},{"Point":50,"Ts":"2018-10-01T01:58:12Z","NoData":true},{"Point":51,"Ts":"2018-10-01T01:46:12Z","NoData":true},{"Point":52,"Ts":"2018-10-01T01:34:12Z","NoData":true},{"Point":53,"Ts":"2018-10-01T01:22:12Z","NoData":true},{"Point":54,"Ts":"2018-10-01T01:10:12Z","NoData":true},{"Point":55,"Ts":"2018-10-01T00:58:12Z","NoData":true},{"Point":56,"Ts":"2018-10-01T00:46:12Z","NoData":true},{"Point":57,"Ts":"2018-10-01T00:34:12Z","NoData":true},{"Point":58,"Ts":"2018-10-01T00:22:12Z","NoData":true},{"Point":59,"Ts":"2018-10-01T00:10:12Z","NoData":true}]}',
      'status': 200,
      'ok': true,
      'statusText': 'OK',
      'type': 2,
      'url': 'http://localhost/qan-api/qan/report/45845e61c7ee444b7e6a17891118a66a/query/b3a7070408ce8743f7ca1180f9cee82d?begin=2018-09-30T23:58:12&end=2018-10-01T11:58:12',
      json: () => {
        return JSON.parse(dataResponse._body)
      }
    };

    backend.connections.subscribe(connection => {
      connection.mockRespond(dataResponse);
    });

    const result = service.getSummary('serverUUID', '123456789', '987654321');
    tick();
    expect(result).toBeTruthy();
  }));

  it('should be true if getTableInfo response data is valid', fakeAsync(() => {
    const dataResponse = {
      '_body': '{"InstanceId":"45845e61c7ee444b7e6a17891118a66a","Begin":"2018-09-30T23:58:12Z","End":"2018-10-01T11:58:12Z","Query":{"Id":"b3a7070408ce8743f7ca1180f9cee82d","Abstract":"INSERT sbtest1","Fingerprint":"INSERT sbtest1","Tables":null,"FirstSeen":"2018-10-01T11:51:00Z","LastSeen":"2018-10-01T11:56:00Z","Status":"new"},"Metrics":null,"Example":{"QueryId":"","InstanceUUID":"","Period":"2018-10-01T00:00:00Z","Ts":"2018-10-01T11:55:00Z","Db":"sbtest","QueryTime":57750,"Query":"{\\"ns\\":\\"sbtest.sbtest1\\",\\"op\\":\\"insert\\"}\\n"},"Metrics2":{"Query_count":148,"Query_time_sum":270.87,"Query_time_min":0.297,"Query_time_avg":3.319498,"Query_time_med":2.837,"Query_time_p95":6.5765,"Query_time_max":15.601,"Lock_time_sum":0,"Lock_time_min":0,"Lock_time_avg":0,"Lock_time_med":0,"Lock_time_p95":0,"Lock_time_max":0,"Rows_sent_sum":0,"Rows_sent_min":0,"Rows_sent_avg":0,"Rows_sent_med":0,"Rows_sent_p95":0,"Rows_sent_max":0,"Rows_examined_sum":0,"Rows_examined_min":0,"Rows_examined_avg":0,"Rows_examined_med":0,"Rows_examined_p95":0,"Rows_examined_max":0,"Bytes_sent_sum":5920,"Bytes_sent_min":40,"Bytes_sent_avg":40,"Bytes_sent_med":40,"Bytes_sent_p95":40,"Bytes_sent_max":40,"Query_count_of_total":0.058870327,"Query_time_sum_of_total":0.06435997,"Lock_time_sum_of_total":0,"Rows_sent_sum_of_total":0,"Rows_examined_sum_of_total":0,"Bytes_sent_sum_of_total":0.058870327,"Point":0,"Ts":"0001-01-01T00:00:00Z","NoData":false,"Query_count_per_sec":0.003425926,"Query_time_sum_per_sec":0.0062701385,"Bytes_sent_sum_per_sec":0.13703704},"Sparks2":[{"Point":0,"Ts":"2018-10-01T11:58:12Z","NoData":false,"Query_count_per_sec":0.2056,"Query_time_sum_per_sec":0.37620834,"Bytes_sent_sum_per_sec":8.2222},{"Point":1,"Ts":"2018-10-01T11:46:12Z","NoData":true},{"Point":2,"Ts":"2018-10-01T11:34:12Z","NoData":true},{"Point":3,"Ts":"2018-10-01T11:22:12Z","NoData":true},{"Point":4,"Ts":"2018-10-01T11:10:12Z","NoData":true},{"Point":5,"Ts":"2018-10-01T10:58:12Z","NoData":true},{"Point":6,"Ts":"2018-10-01T10:46:12Z","NoData":true},{"Point":7,"Ts":"2018-10-01T10:34:12Z","NoData":true},{"Point":8,"Ts":"2018-10-01T10:22:12Z","NoData":true},{"Point":9,"Ts":"2018-10-01T10:10:12Z","NoData":true},{"Point":10,"Ts":"2018-10-01T09:58:12Z","NoData":true},{"Point":11,"Ts":"2018-10-01T09:46:12Z","NoData":true},{"Point":12,"Ts":"2018-10-01T09:34:12Z","NoData":true},{"Point":13,"Ts":"2018-10-01T09:22:12Z","NoData":true},{"Point":14,"Ts":"2018-10-01T09:10:12Z","NoData":true},{"Point":15,"Ts":"2018-10-01T08:58:12Z","NoData":true},{"Point":16,"Ts":"2018-10-01T08:46:12Z","NoData":true},{"Point":17,"Ts":"2018-10-01T08:34:12Z","NoData":true},{"Point":18,"Ts":"2018-10-01T08:22:12Z","NoData":true},{"Point":19,"Ts":"2018-10-01T08:10:12Z","NoData":true},{"Point":20,"Ts":"2018-10-01T07:58:12Z","NoData":true},{"Point":21,"Ts":"2018-10-01T07:46:12Z","NoData":true},{"Point":22,"Ts":"2018-10-01T07:34:12Z","NoData":true},{"Point":23,"Ts":"2018-10-01T07:22:12Z","NoData":true},{"Point":24,"Ts":"2018-10-01T07:10:12Z","NoData":true},{"Point":25,"Ts":"2018-10-01T06:58:12Z","NoData":true},{"Point":26,"Ts":"2018-10-01T06:46:12Z","NoData":true},{"Point":27,"Ts":"2018-10-01T06:34:12Z","NoData":true},{"Point":28,"Ts":"2018-10-01T06:22:12Z","NoData":true},{"Point":29,"Ts":"2018-10-01T06:10:12Z","NoData":true},{"Point":30,"Ts":"2018-10-01T05:58:12Z","NoData":true},{"Point":31,"Ts":"2018-10-01T05:46:12Z","NoData":true},{"Point":32,"Ts":"2018-10-01T05:34:12Z","NoData":true},{"Point":33,"Ts":"2018-10-01T05:22:12Z","NoData":true},{"Point":34,"Ts":"2018-10-01T05:10:12Z","NoData":true},{"Point":35,"Ts":"2018-10-01T04:58:12Z","NoData":true},{"Point":36,"Ts":"2018-10-01T04:46:12Z","NoData":true},{"Point":37,"Ts":"2018-10-01T04:34:12Z","NoData":true},{"Point":38,"Ts":"2018-10-01T04:22:12Z","NoData":true},{"Point":39,"Ts":"2018-10-01T04:10:12Z","NoData":true},{"Point":40,"Ts":"2018-10-01T03:58:12Z","NoData":true},{"Point":41,"Ts":"2018-10-01T03:46:12Z","NoData":true},{"Point":42,"Ts":"2018-10-01T03:34:12Z","NoData":true},{"Point":43,"Ts":"2018-10-01T03:22:12Z","NoData":true},{"Point":44,"Ts":"2018-10-01T03:10:12Z","NoData":true},{"Point":45,"Ts":"2018-10-01T02:58:12Z","NoData":true},{"Point":46,"Ts":"2018-10-01T02:46:12Z","NoData":true},{"Point":47,"Ts":"2018-10-01T02:34:12Z","NoData":true},{"Point":48,"Ts":"2018-10-01T02:22:12Z","NoData":true},{"Point":49,"Ts":"2018-10-01T02:10:12Z","NoData":true},{"Point":50,"Ts":"2018-10-01T01:58:12Z","NoData":true},{"Point":51,"Ts":"2018-10-01T01:46:12Z","NoData":true},{"Point":52,"Ts":"2018-10-01T01:34:12Z","NoData":true},{"Point":53,"Ts":"2018-10-01T01:22:12Z","NoData":true},{"Point":54,"Ts":"2018-10-01T01:10:12Z","NoData":true},{"Point":55,"Ts":"2018-10-01T00:58:12Z","NoData":true},{"Point":56,"Ts":"2018-10-01T00:46:12Z","NoData":true},{"Point":57,"Ts":"2018-10-01T00:34:12Z","NoData":true},{"Point":58,"Ts":"2018-10-01T00:22:12Z","NoData":true},{"Point":59,"Ts":"2018-10-01T00:10:12Z","NoData":true}]}',
      'status': 200,
      'ok': true,
      'statusText': 'OK',
      'type': 2,
      'url': 'http://localhost/qan-api/qan/report/45845e61c7ee444b7e6a17891118a66a/query/b3a7070408ce8743f7ca1180f9cee82d?begin=2018-09-30T23:58:12&end=2018-10-01T11:58:12',
      json: () => {
        return JSON.parse(dataResponse._body)
      }
    };

    backend.connections.subscribe(connection => {
      connection.mockRespond(dataResponse);
    });

    const result = service.getTableInfo('agentUUID', 'serverUUID', '123456789', '987654321');
    tick();
    expect(result).toBeTruthy();
  }));

  it('should be true if getExplain response data is valid', fakeAsync(() => {
    const dataResponse = {
      '_body': '{"InstanceId":"45845e61c7ee444b7e6a17891118a66a","Begin":"2018-09-30T23:58:12Z","End":"2018-10-01T11:58:12Z","Query":{"Id":"b3a7070408ce8743f7ca1180f9cee82d","Abstract":"INSERT sbtest1","Fingerprint":"INSERT sbtest1","Tables":null,"FirstSeen":"2018-10-01T11:51:00Z","LastSeen":"2018-10-01T11:56:00Z","Status":"new"},"Metrics":null,"Example":{"QueryId":"","InstanceUUID":"","Period":"2018-10-01T00:00:00Z","Ts":"2018-10-01T11:55:00Z","Db":"sbtest","QueryTime":57750,"Query":"{\\"ns\\":\\"sbtest.sbtest1\\",\\"op\\":\\"insert\\"}\\n"},"Metrics2":{"Query_count":148,"Query_time_sum":270.87,"Query_time_min":0.297,"Query_time_avg":3.319498,"Query_time_med":2.837,"Query_time_p95":6.5765,"Query_time_max":15.601,"Lock_time_sum":0,"Lock_time_min":0,"Lock_time_avg":0,"Lock_time_med":0,"Lock_time_p95":0,"Lock_time_max":0,"Rows_sent_sum":0,"Rows_sent_min":0,"Rows_sent_avg":0,"Rows_sent_med":0,"Rows_sent_p95":0,"Rows_sent_max":0,"Rows_examined_sum":0,"Rows_examined_min":0,"Rows_examined_avg":0,"Rows_examined_med":0,"Rows_examined_p95":0,"Rows_examined_max":0,"Bytes_sent_sum":5920,"Bytes_sent_min":40,"Bytes_sent_avg":40,"Bytes_sent_med":40,"Bytes_sent_p95":40,"Bytes_sent_max":40,"Query_count_of_total":0.058870327,"Query_time_sum_of_total":0.06435997,"Lock_time_sum_of_total":0,"Rows_sent_sum_of_total":0,"Rows_examined_sum_of_total":0,"Bytes_sent_sum_of_total":0.058870327,"Point":0,"Ts":"0001-01-01T00:00:00Z","NoData":false,"Query_count_per_sec":0.003425926,"Query_time_sum_per_sec":0.0062701385,"Bytes_sent_sum_per_sec":0.13703704},"Sparks2":[{"Point":0,"Ts":"2018-10-01T11:58:12Z","NoData":false,"Query_count_per_sec":0.2056,"Query_time_sum_per_sec":0.37620834,"Bytes_sent_sum_per_sec":8.2222},{"Point":1,"Ts":"2018-10-01T11:46:12Z","NoData":true},{"Point":2,"Ts":"2018-10-01T11:34:12Z","NoData":true},{"Point":3,"Ts":"2018-10-01T11:22:12Z","NoData":true},{"Point":4,"Ts":"2018-10-01T11:10:12Z","NoData":true},{"Point":5,"Ts":"2018-10-01T10:58:12Z","NoData":true},{"Point":6,"Ts":"2018-10-01T10:46:12Z","NoData":true},{"Point":7,"Ts":"2018-10-01T10:34:12Z","NoData":true},{"Point":8,"Ts":"2018-10-01T10:22:12Z","NoData":true},{"Point":9,"Ts":"2018-10-01T10:10:12Z","NoData":true},{"Point":10,"Ts":"2018-10-01T09:58:12Z","NoData":true},{"Point":11,"Ts":"2018-10-01T09:46:12Z","NoData":true},{"Point":12,"Ts":"2018-10-01T09:34:12Z","NoData":true},{"Point":13,"Ts":"2018-10-01T09:22:12Z","NoData":true},{"Point":14,"Ts":"2018-10-01T09:10:12Z","NoData":true},{"Point":15,"Ts":"2018-10-01T08:58:12Z","NoData":true},{"Point":16,"Ts":"2018-10-01T08:46:12Z","NoData":true},{"Point":17,"Ts":"2018-10-01T08:34:12Z","NoData":true},{"Point":18,"Ts":"2018-10-01T08:22:12Z","NoData":true},{"Point":19,"Ts":"2018-10-01T08:10:12Z","NoData":true},{"Point":20,"Ts":"2018-10-01T07:58:12Z","NoData":true},{"Point":21,"Ts":"2018-10-01T07:46:12Z","NoData":true},{"Point":22,"Ts":"2018-10-01T07:34:12Z","NoData":true},{"Point":23,"Ts":"2018-10-01T07:22:12Z","NoData":true},{"Point":24,"Ts":"2018-10-01T07:10:12Z","NoData":true},{"Point":25,"Ts":"2018-10-01T06:58:12Z","NoData":true},{"Point":26,"Ts":"2018-10-01T06:46:12Z","NoData":true},{"Point":27,"Ts":"2018-10-01T06:34:12Z","NoData":true},{"Point":28,"Ts":"2018-10-01T06:22:12Z","NoData":true},{"Point":29,"Ts":"2018-10-01T06:10:12Z","NoData":true},{"Point":30,"Ts":"2018-10-01T05:58:12Z","NoData":true},{"Point":31,"Ts":"2018-10-01T05:46:12Z","NoData":true},{"Point":32,"Ts":"2018-10-01T05:34:12Z","NoData":true},{"Point":33,"Ts":"2018-10-01T05:22:12Z","NoData":true},{"Point":34,"Ts":"2018-10-01T05:10:12Z","NoData":true},{"Point":35,"Ts":"2018-10-01T04:58:12Z","NoData":true},{"Point":36,"Ts":"2018-10-01T04:46:12Z","NoData":true},{"Point":37,"Ts":"2018-10-01T04:34:12Z","NoData":true},{"Point":38,"Ts":"2018-10-01T04:22:12Z","NoData":true},{"Point":39,"Ts":"2018-10-01T04:10:12Z","NoData":true},{"Point":40,"Ts":"2018-10-01T03:58:12Z","NoData":true},{"Point":41,"Ts":"2018-10-01T03:46:12Z","NoData":true},{"Point":42,"Ts":"2018-10-01T03:34:12Z","NoData":true},{"Point":43,"Ts":"2018-10-01T03:22:12Z","NoData":true},{"Point":44,"Ts":"2018-10-01T03:10:12Z","NoData":true},{"Point":45,"Ts":"2018-10-01T02:58:12Z","NoData":true},{"Point":46,"Ts":"2018-10-01T02:46:12Z","NoData":true},{"Point":47,"Ts":"2018-10-01T02:34:12Z","NoData":true},{"Point":48,"Ts":"2018-10-01T02:22:12Z","NoData":true},{"Point":49,"Ts":"2018-10-01T02:10:12Z","NoData":true},{"Point":50,"Ts":"2018-10-01T01:58:12Z","NoData":true},{"Point":51,"Ts":"2018-10-01T01:46:12Z","NoData":true},{"Point":52,"Ts":"2018-10-01T01:34:12Z","NoData":true},{"Point":53,"Ts":"2018-10-01T01:22:12Z","NoData":true},{"Point":54,"Ts":"2018-10-01T01:10:12Z","NoData":true},{"Point":55,"Ts":"2018-10-01T00:58:12Z","NoData":true},{"Point":56,"Ts":"2018-10-01T00:46:12Z","NoData":true},{"Point":57,"Ts":"2018-10-01T00:34:12Z","NoData":true},{"Point":58,"Ts":"2018-10-01T00:22:12Z","NoData":true},{"Point":59,"Ts":"2018-10-01T00:10:12Z","NoData":true}]}',
      'status': 200,
      'ok': true,
      'statusText': 'OK',
      'type': 2,
      'url': 'http://localhost/qan-api/qan/report/45845e61c7ee444b7e6a17891118a66a/query/b3a7070408ce8743f7ca1180f9cee82d?begin=2018-09-30T23:58:12&end=2018-10-01T11:58:12',
      json: () => {
        return JSON.parse(dataResponse._body)
      }
    };

    backend.connections.subscribe(connection => {
      connection.mockRespond(dataResponse);
    });

    const result = service.getExplain('agentUUID', 'serverUUID', '123456789', '987654321');
    tick();
    expect(result).toBeTruthy();
  }));

  it('should be true if updateTables response data is valid', fakeAsync(() => {
    const dataResponse = {
      '_body': '{"InstanceId":"45845e61c7ee444b7e6a17891118a66a","Begin":"2018-09-30T23:58:12Z","End":"2018-10-01T11:58:12Z","Query":{"Id":"b3a7070408ce8743f7ca1180f9cee82d","Abstract":"INSERT sbtest1","Fingerprint":"INSERT sbtest1","Tables":null,"FirstSeen":"2018-10-01T11:51:00Z","LastSeen":"2018-10-01T11:56:00Z","Status":"new"},"Metrics":null,"Example":{"QueryId":"","InstanceUUID":"","Period":"2018-10-01T00:00:00Z","Ts":"2018-10-01T11:55:00Z","Db":"sbtest","QueryTime":57750,"Query":"{\\"ns\\":\\"sbtest.sbtest1\\",\\"op\\":\\"insert\\"}\\n"},"Metrics2":{"Query_count":148,"Query_time_sum":270.87,"Query_time_min":0.297,"Query_time_avg":3.319498,"Query_time_med":2.837,"Query_time_p95":6.5765,"Query_time_max":15.601,"Lock_time_sum":0,"Lock_time_min":0,"Lock_time_avg":0,"Lock_time_med":0,"Lock_time_p95":0,"Lock_time_max":0,"Rows_sent_sum":0,"Rows_sent_min":0,"Rows_sent_avg":0,"Rows_sent_med":0,"Rows_sent_p95":0,"Rows_sent_max":0,"Rows_examined_sum":0,"Rows_examined_min":0,"Rows_examined_avg":0,"Rows_examined_med":0,"Rows_examined_p95":0,"Rows_examined_max":0,"Bytes_sent_sum":5920,"Bytes_sent_min":40,"Bytes_sent_avg":40,"Bytes_sent_med":40,"Bytes_sent_p95":40,"Bytes_sent_max":40,"Query_count_of_total":0.058870327,"Query_time_sum_of_total":0.06435997,"Lock_time_sum_of_total":0,"Rows_sent_sum_of_total":0,"Rows_examined_sum_of_total":0,"Bytes_sent_sum_of_total":0.058870327,"Point":0,"Ts":"0001-01-01T00:00:00Z","NoData":false,"Query_count_per_sec":0.003425926,"Query_time_sum_per_sec":0.0062701385,"Bytes_sent_sum_per_sec":0.13703704},"Sparks2":[{"Point":0,"Ts":"2018-10-01T11:58:12Z","NoData":false,"Query_count_per_sec":0.2056,"Query_time_sum_per_sec":0.37620834,"Bytes_sent_sum_per_sec":8.2222},{"Point":1,"Ts":"2018-10-01T11:46:12Z","NoData":true},{"Point":2,"Ts":"2018-10-01T11:34:12Z","NoData":true},{"Point":3,"Ts":"2018-10-01T11:22:12Z","NoData":true},{"Point":4,"Ts":"2018-10-01T11:10:12Z","NoData":true},{"Point":5,"Ts":"2018-10-01T10:58:12Z","NoData":true},{"Point":6,"Ts":"2018-10-01T10:46:12Z","NoData":true},{"Point":7,"Ts":"2018-10-01T10:34:12Z","NoData":true},{"Point":8,"Ts":"2018-10-01T10:22:12Z","NoData":true},{"Point":9,"Ts":"2018-10-01T10:10:12Z","NoData":true},{"Point":10,"Ts":"2018-10-01T09:58:12Z","NoData":true},{"Point":11,"Ts":"2018-10-01T09:46:12Z","NoData":true},{"Point":12,"Ts":"2018-10-01T09:34:12Z","NoData":true},{"Point":13,"Ts":"2018-10-01T09:22:12Z","NoData":true},{"Point":14,"Ts":"2018-10-01T09:10:12Z","NoData":true},{"Point":15,"Ts":"2018-10-01T08:58:12Z","NoData":true},{"Point":16,"Ts":"2018-10-01T08:46:12Z","NoData":true},{"Point":17,"Ts":"2018-10-01T08:34:12Z","NoData":true},{"Point":18,"Ts":"2018-10-01T08:22:12Z","NoData":true},{"Point":19,"Ts":"2018-10-01T08:10:12Z","NoData":true},{"Point":20,"Ts":"2018-10-01T07:58:12Z","NoData":true},{"Point":21,"Ts":"2018-10-01T07:46:12Z","NoData":true},{"Point":22,"Ts":"2018-10-01T07:34:12Z","NoData":true},{"Point":23,"Ts":"2018-10-01T07:22:12Z","NoData":true},{"Point":24,"Ts":"2018-10-01T07:10:12Z","NoData":true},{"Point":25,"Ts":"2018-10-01T06:58:12Z","NoData":true},{"Point":26,"Ts":"2018-10-01T06:46:12Z","NoData":true},{"Point":27,"Ts":"2018-10-01T06:34:12Z","NoData":true},{"Point":28,"Ts":"2018-10-01T06:22:12Z","NoData":true},{"Point":29,"Ts":"2018-10-01T06:10:12Z","NoData":true},{"Point":30,"Ts":"2018-10-01T05:58:12Z","NoData":true},{"Point":31,"Ts":"2018-10-01T05:46:12Z","NoData":true},{"Point":32,"Ts":"2018-10-01T05:34:12Z","NoData":true},{"Point":33,"Ts":"2018-10-01T05:22:12Z","NoData":true},{"Point":34,"Ts":"2018-10-01T05:10:12Z","NoData":true},{"Point":35,"Ts":"2018-10-01T04:58:12Z","NoData":true},{"Point":36,"Ts":"2018-10-01T04:46:12Z","NoData":true},{"Point":37,"Ts":"2018-10-01T04:34:12Z","NoData":true},{"Point":38,"Ts":"2018-10-01T04:22:12Z","NoData":true},{"Point":39,"Ts":"2018-10-01T04:10:12Z","NoData":true},{"Point":40,"Ts":"2018-10-01T03:58:12Z","NoData":true},{"Point":41,"Ts":"2018-10-01T03:46:12Z","NoData":true},{"Point":42,"Ts":"2018-10-01T03:34:12Z","NoData":true},{"Point":43,"Ts":"2018-10-01T03:22:12Z","NoData":true},{"Point":44,"Ts":"2018-10-01T03:10:12Z","NoData":true},{"Point":45,"Ts":"2018-10-01T02:58:12Z","NoData":true},{"Point":46,"Ts":"2018-10-01T02:46:12Z","NoData":true},{"Point":47,"Ts":"2018-10-01T02:34:12Z","NoData":true},{"Point":48,"Ts":"2018-10-01T02:22:12Z","NoData":true},{"Point":49,"Ts":"2018-10-01T02:10:12Z","NoData":true},{"Point":50,"Ts":"2018-10-01T01:58:12Z","NoData":true},{"Point":51,"Ts":"2018-10-01T01:46:12Z","NoData":true},{"Point":52,"Ts":"2018-10-01T01:34:12Z","NoData":true},{"Point":53,"Ts":"2018-10-01T01:22:12Z","NoData":true},{"Point":54,"Ts":"2018-10-01T01:10:12Z","NoData":true},{"Point":55,"Ts":"2018-10-01T00:58:12Z","NoData":true},{"Point":56,"Ts":"2018-10-01T00:46:12Z","NoData":true},{"Point":57,"Ts":"2018-10-01T00:34:12Z","NoData":true},{"Point":58,"Ts":"2018-10-01T00:22:12Z","NoData":true},{"Point":59,"Ts":"2018-10-01T00:10:12Z","NoData":true}]}',
      'status': 200,
      'ok': true,
      'statusText': 'OK',
      'type': 2,
      'url': 'http://localhost/qan-api/qan/report/45845e61c7ee444b7e6a17891118a66a/query/b3a7070408ce8743f7ca1180f9cee82d?begin=2018-09-30T23:58:12&end=2018-10-01T11:58:12',
      json: () => {
        return JSON.parse(dataResponse._body)
      }
    };

    backend.connections.subscribe(connection => {
      connection.mockRespond(dataResponse);
    });

    const result = service.updateTables('agentUUID', []);
    tick();
    expect(result).toBeTruthy();
  }));

});
